var ChineseChatV2;(function(n){function uf(n){o&&(t=n,af(),sf(),ef(),y++,su()?ft(ai,"externallink"):typeof t.traceId=="undefined"||t.traceId==null||t.traceId==""?ft(t.searchQuery,"searchbox"):ff("searchbox"),wf(),te())}function ff(n){var i=sj_gx(),r=(new Date).getTime();i.ontimeout=function(){ft(t.searchQuery,"searchbox");c()&&(r=(new Date).getTime()-r,Log.Log("FailGet",e,"getHookResponse",!1,"timeTaken",r.toString()))};i.open("POST",t.UrlForHookResponse,!0);i.setRequestHeader("Content-Type","text/plain");i.timeout=3e3;sj_be(i,"readystatechange",function(){if(i.readyState==4){r=(new Date).getTime()-r;var u=!1;i.status==200&&i.responseText?(u=pu(i.responseText,n),c()&&(u?Log.Log("SuccessGet",e,"getZoChatBySendText",!1,"timeTaken",r.toString(),"resDT",gi,"resText",nr,"AnswerFeed",ii,"EmotionInfo",vi,"CustomLog",yi):Log.Log("FailGet",e,"getZoChatBySendText",!1,"timeTaken",r.toString(),"resType","HookResponse"))):ft(t.searchQuery,"searchbox")}});i.send(t.traceId)}function su(){for(var n,r,f=t.LinkUrl.split("?")[1].split("&"),u,i=0;i<f.length;i++)n=f[i].split("="),n[0]=="form"&&(n[1]=="000015"||n[1]=="MO0036"||n[1]=="MO0037")&&(ct=!0,u=n[1]),n[0]=="q"&&(ai=decodeURI(n[1]));if(ct)for(ct=!1,r=[],u=="000015"?r=["讲笑话","成语接龙","电影推荐","男女友类型测试","求生欲","土味情话套路"]:u=="MO0036"?r=["星座运势"]:u=="MO0037"&&(r=["白羊座 星座运势","金牛座 星座运势","双子座 星座运势","巨蟹座 星座运势","狮子座 星座运势","处女座 星座运势","天秤座 星座运势","天蝎座 星座运势","射手座 星座运势","摩羯座 星座运势","水瓶座 星座运势","双鱼座 星座运势"]),i=0;i<r.length;i++)if(ai==r[i]){ct=!0;break}return ct}function ef(){var n,i,u;df();gf();pf();kf();n=_ge("ev_tb_maxclose");sj_be(n,"click",function(){lf()});sj_be(r,"click",function(){wi?wi=!1:ar(!0)});sj_be(_ge(wr),"click",hu);t.IsMobileChat&&(ut=window.screen.width-69,ut>348?ut=348:ut<270&&(ut=270),i=ut-72,_ge("ev_talkbox_max").style.width=ut+"px",_ge("ev_send_text").style.width=i+"px");u=_ge(si);sj_be(u,"keydown",function(n){n.keyCode==13&&(hu(),sj_pd(n))});setInterval(of,50)}function of(){var n=window.innerHeight-300,t,i;fr!=n&&(fr=n,n<388?(_ge("ev_talkbox").style.height=n+"px",_ge("ev_tb_header_dropdown_background").style.height=n+"px",t=n+91,_ge("ev_disable_popup_background").style.height=t+"px",_ge("ev_iframe_talk").style.height=t+"px",_ge("ev_enlarge_background").style.height=t+"px",n<282?(i=n-131,i<51&&(i=51),_ge("ev_disable_popup_setting").style.top=i+"px"):_ge("ev_disable_popup_setting").style.top="151px"):(_ge("ev_talkbox").style.height="388px",_ge("ev_tb_header_dropdown_background").style.height="388px",_ge("ev_disable_popup_background").style.height="479px",_ge("ev_iframe_talk").style.height="479px",_ge("ev_enlarge_background").style.height="479px"))}function sf(){var n=o.parentElement,t=_ge("b_content");t&&t.insertBefore(o,t.firstChild);n&&n.parentElement&&n.tagName.toLowerCase()=="li"&&Lib.CssClass.contains(n,"b_ans")&&n.parentElement.removeChild(n)}function hu(){var r=_ge(si),t=r.value,f=(new Date).getTime();if(t){sj_cook.setNoCrumbs(ru,"0",!0,"/",10080);pi&&(sj_cook.clear(ci),pi=!1);r.value="";var u=et(t,!1,!1,"","1"),n=_ge(v),i=MsnShared.getElementsByClassName("ev_zo_typing","div",n);i&&i.length>0?n.insertBefore(u,i[0].parentElement):n.appendChild(u);n.scrollTop=n.scrollHeight;y==0&&lr();y++;ft(t,"chatbox");c()&&Log.Log("DHTMLClick",e,"sendText",!1,"UQ",t,"ST",f.toString())}}function ft(n,r){var f,o,u,h;t.ZoChatV2Url&&(f=(new Date).getTime(),n=Aes.encrypt(n,t.ZoAESPassword,t.ZoAESBitCount),o={NormalizedQuery:n},u=sj_gx(),u.open("POST",t.ZoChatV2Url,!0),sj_be(u,"readystatechange",function(){var n,t;u.readyState==4&&(f=(new Date).getTime()-f,n=!1,r!="disablechat"?(u.status==200&&u.responseText?(n=pu(u.responseText,r),n||bi()):(bi(),t=["脑子不转啦，等我休息一下","我刚刚想说啥来着呢...","你猜我会回复你啥？","词穷了，等我歇会儿","（让我想想怎么回复你）"],bt(t[Math.floor(Math.random()*t.length)],"1")),c()&&(n?Log.Log("SuccessGet",e,"getZoChatBySendText",!1,"timeTaken",f.toString(),"resDT",gi,"resText",nr,"AnswerFeed",ii,"EmotionInfo",vi,"CustomLog",yi):Log.Log("FailGet",e,"getZoChatBySendText",!1,"timeTaken",f.toString()))):(u.status==200&&u.responseText?bt("再见啦~如果想我的话，在必应国内版搜索【小冰】，我就会出来陪你啦~","1"):bt("不好意思，本次操作失败了~已反馈，请您稍后再试~","1"),MsnShared.show(b),MsnShared.hide(w),sj_cook.set(gt,ni,s),it.className=rt,g.innerHTML=yt,i=s,MsnShared.hide(st),MsnShared.hide(l),setTimeout(bf,7e3),c()&&(n?Log.Log("SuccessDiable",e,"disableChatbot",!1,"timeTaken",f.toString()):Log.Log("FailDisable",e,"disableChatbot",!1,"timeTaken",f.toString()))))}),h={zoTextResponse:dr,zoIsGCSResponse:kr,zoSearchQuery:t.searchQuery,zoTimestampUtc:gr,zoIsStartOfSession:br,zoRequestId:hf(),conversationId:t.conversationId,query:o,from:r,traceId:t.traceId},br="false",kr="true",u.send(JSON.stringify(h)))}function cu(n,t){var r,i,u;y--;n&&n.length>0&&(r=_ge(v),i=MsnShared.getElementsByClassName("ev_zo_typing","div",r),i&&i.length>0?y==0?(i[0].innerHTML="",lu(i[0],n,t),MsnShared.removeClass(i[0],"ev_zo_typing")):(u=et("",!0,!1,n,t),r.insertBefore(u,i[0].parentElement)):(u=et("",!0,!1,n,t),r.appendChild(u)),r.scrollTop=r.scrollHeight,gi=(new Date).getTime().toString())}function et(n,i,r,f,e){var p,a,s,c,y,h,w,o,b,l;return r&&(p=_ge(v),a=MsnShared.getElementsByClassName("ev_zo_typing","div",p),a&&a.length>0)?null:(s=sj_ce("div",null,"ev_msg_wrapper"),i?(h=sj_ce("div","ev_zo_img","ev_zo_img"),s.appendChild(h)):(c=typeof Identity!="undefined"&&Identity.wlProfile&&Identity.wlProfile(),c&&c.img?(y=sj_ce("img",null,"ev_my_img"),y.src=c.img,s.appendChild(y)):(h=sj_ce("div",null,"ev_my_img"),s.appendChild(h))),w=i?"ev_zo_msg":"ev_my_msg",o=sj_ce("div",null,w),t.IsMobileChat&&(b=ut-146,o.style.maxWidth=b+"px"),r?(o.innerHTML="<span><\/span>",MsnShared.addClass(o,"ev_zo_typing")):i&&f&&f.length>0?lu(o,f,e):e=="2"?(l=sj_ce("img","ev_zo_image","ev_zo_image"),l.src=n,MsnShared.removeClass(o,"ev_zo_msg"),s.appendChild(l),l.onclick=function(){nt.className="ev_show_enlarge_img";ht.className="ev_enlarge_img";ht.src=n;u.src=n;u.complete?ki():u.onload=function(){ki()}}):o.innerText=n,s.appendChild(o),s)}function lu(n,i,r){for(var f,o,l,s,h=0;h<i.length;h++)f=i[h],f.Entity&&(f.IsEntity?(o=sj_ce("a",null,"ev_zo_entity"),o.href=MsnShared.stringFormat(wu,encodeURI(f.Entity),sr),o.innerText=f.Entity,n.appendChild(o),sj_be(o,"click",function(){c()&&Log.Log("DHTMLClick",e,"zoentity",!1,"zoentity",o.innerHTML)}),sj_be(o,"mousemove",function(n){var t=MsnShared.getElementsByClassName("ev_zo_tooltip","div",_d.body),i,r;t&&t.length>0&&(MsnShared.show(t[0]),i=n.clientX+_d.documentElement.scrollLeft,r=n.clientY+_d.documentElement.scrollTop,t[0].style.top=r+26+"px",t[0].style.left=i+"px")}),sj_be(o,"mouseout",function(){var n=MsnShared.getElementsByClassName("ev_zo_tooltip","span",_d.body);n&&n.length>0&&MsnShared.hide(n[0])})):r=="2"?(l=sj_ce("img","ev_zo_image","ev_zo_image"),l.src=f.Entity,MsnShared.removeClass(n,"ev_zo_msg"),n.appendChild(l),l.onclick=function(){nt.className="ev_show_enlarge_img";ht.className="ev_enlarge_img";ht.src=f.Entity;u.src=f.Entity;u.complete?ki():u.onload=function(){ki()}}):(s=sj_ce("span",null,null),s.innerText=f.Entity,n.appendChild(s)));t.EnableShowAnswerFeed&&(s=sj_ce("span",null,null),s.innerText="["+ii+"]",n.appendChild(s))}function ot(){return((1+Math.random())*65536|0).toString(16).substring(1)}function hf(){return(ot()+ot()+ot()+ot()+ot()+ot()+ot()+ot()).toLowerCase()}function cf(){MsnShared.show(o)}function lr(){var t=et("",!0,!0,"",""),n;t&&(n=_ge(v),n.appendChild(t),n.scrollTop=n.scrollHeight)}function bi(){var i,n,t;if(y--,y==0&&(i=_ge(v),n=MsnShared.getElementsByClassName("ev_zo_typing","div",i),n&&n.length>0))for(t=0;t<n.length;t++)n[t].parentElement.parentElement.removeChild(n[t].parentElement)}function ar(n){if(f&&r){MsnShared.removeClass(o,"ev_talkbox_wrapper_min");MsnShared.addClass(o,"ev_talkbox_wrapper");MsnShared.show(f);MsnShared.hide(r);var t=_ge(v);t.scrollTop=t.scrollHeight;n&&(vr(dt),i==lt||i==ti?(MsnShared.show(w),MsnShared.hide(b)):iu&&(iu=!1,y=1,ft("","click")),c()&&Log.Log("DHTMLClick",e,"maximizeZo",!1,"botType",i))}}function lf(){f&&r&&(MsnShared.removeClass(o,"ev_talkbox_wrapper"),MsnShared.addClass(o,"ev_talkbox_wrapper_min"),MsnShared.hide(f),MsnShared.show(r),vr(ir),i==s?(oi(),r.className="ev_talkbox_cn_min",h.className="ev_min_cn_img"):(sb_ct(ei),sb_ct(fi),sb_ct(wt),h.style.cssText=";background-image: url("+t.VirtualCharacterEntryUrl+")",r.className="ev_talkbox_virtual_min",h.className="ev_min_virtual_img"),c()&&Log.Log("DHTMLClick",e,"minimizeZo",!1,"botType",i))}function vr(n){n==dt||n==ir?sj_cook.set(hi,tr,n):sj_cook.clear(hi)}function c(){return typeof Log!="undefined"&&Log!==null&&typeof Log.Log!="undefined"}function af(){var n,ft,et,oi,c,ct,u,wt,y,rt,bt,kt,dt,ii,ri,pi,wi,ut;i=sj_cook.get(gt,ni);i==null&&(i=s);i!=lt&&i!=ti||t.iframeTalkStatus&&navigator.cookieEnabled||(i=s,sj_cook.set(gt,ni,i));n=sj_ce("div",null,"ev_tb_header");a.innerText="关闭";ft=sj_ce("div","ev_disable_popup_setting_pop","ev_disable_popup_setting_pop");ft.innerText="确认要关闭吗？";et=sj_ce("div","ev_disable_popup_setting_body","ev_disable_popup_setting_body");et.innerText="接下来的很长一段时间，你都不会看到我了";var ot=sj_ce("div","ev_disable_popup_setting_bottom","ev_disable_popup_setting_bottom"),fi=sj_ce("div","ev_disable_popup_setting_btn1","ev_disable_popup_setting_btn1"),ei=sj_ce("div","ev_disable_popup_setting_btn2","ev_disable_popup_setting_btn2");fi.innerText="确定";ei.innerText="再想想";ot.appendChild(fi);ot.appendChild(ei);l.appendChild(ft);l.appendChild(et);l.appendChild(ot);f.appendChild(a);f.appendChild(st);f.appendChild(l);oi=sj_ce("div","ev_tb_disable","ev_tb_disable");n.appendChild(oi);c=sj_ce("div","ev_tb_header_text","ev_tb_disable_header_text");c.appendChild(g);c.appendChild(d);n.appendChild(c);ct=sj_ce("span","ev_tb_maxclose","ev_tb_disable_close");n.appendChild(ct);ct.appendChild(sj_ce("span","ev_tb_maxclose_img","ev_tb_close_img"));it.innerText=yt;at.innerText=er;vt.innerText=or;u=sj_ce("div","ev_tb_header_dropdown_button","ev_tb_header_dropdown_button");wt=sj_ce("div","ev_tb_header_dropdown_text","ev_tb_header_dropdown_text");wt.innerText="点击切换聊天对象";tt.appendChild(wt);tt.appendChild(u);tt.appendChild(sj_ce("div","ev_tb_header_dropdown_background",null));u.appendChild(it);u.appendChild(at);u.appendChild(vt);y=sj_ce("div","ev_send_input",null);rt=sj_ce("textarea",si,"ev_send_text");rt.setAttribute("type","text");rt.setAttribute("placeholder",t.placeHolder);bt=sj_ce("div",wr,"ev_send_button");bt.appendChild(sj_ce("div","ev_send_button_img","ev_send_button_img"));y.appendChild(rt);y.appendChild(bt);f.appendChild(n);kt=sj_ce("div","ev_privacy_text_top",null);kt.innerText="由红棉小冰提供的虚拟人类已唤醒，可以随时开始聊天啦";dt=sj_ce("div","ev_privacy_text_bottom_text",null);ii=sj_ce("div","ev_privacy_text_bottom",null);dt.innerText="本服务由小冰公司运营";ii.appendChild(dt);f.appendChild(tt);ri=sj_ce("span",v,"ev_talkbox");ri.appendChild(kt);nt.appendChild(ht);nt.appendChild(ur);nt.appendChild(bu);f.appendChild(nt);b.appendChild(ri);b.appendChild(ii);b.appendChild(y);f.appendChild(b);f.appendChild(w);r.appendChild(h);i==s?(pt=!0,h.style.cssText=";background-image: url("+t.BlinkEyeEntryUrl+"); width: 75px",r.className="ev_talkbox_cn_min",h.className="ev_min_cn_img"):(h.style.cssText=";background-image: url("+t.VirtualCharacterEntryUrl+")",r.className="ev_talkbox_virtual_min",h.className="ev_min_virtual_img");var e=sj_ce("div","ev_hook_header","ev_hook_header"),bi=sj_ce("div","ev_hook_header_img","ev_hook_header_img"),hi=sj_ce("div","ev_hook_header_isRead","ev_hook_header_isRead"),ui=sj_ce("div","ev_hook_header_text","ev_hook_header_text"),ci=sj_ce("div","ev_hook_header_text_title","ev_hook_header_text_title"),li=sj_ce("div","ev_hook_header_text_reply","ev_hook_header_text_reply");ci.innerText=yt;li.innerText=du;hi.innerText="1";var ki=sj_ce("div","ev_hook_header_close","ev_hook_header_close"),ai=sj_ce("div","ev_hook_send","ev_hook_send"),vi=sj_ce("div","ev_hook_send_input","ev_hook_send_input"),yi=sj_ce("div","ev_hook_send_input_placeholder","ev_hook_send_input_placeholder");yi.innerText="回复小冰";vi.appendChild(yi);ui.appendChild(ci);ui.appendChild(li);e.appendChild(bi);e.appendChild(hi);e.appendChild(ui);e.appendChild(ki);ai.appendChild(vi);k.appendChild(e);k.appendChild(ai);o.appendChild(k);o.appendChild(f);o.appendChild(r);typeof _ge("sbBoxCnt")!="undefined"&&_ge("sbBoxCnt")!==null&&(hr=!0,p.src=t.EntranceAnimationUrl,_ge("sbBoxCnt").appendChild(p),pi=MsnShared.getElementsByClassName("b_unarfo","div",_ge("uaanswer")),wi=vf(pi[0].innerText,'12px/1.6 "Microsoft Yahei"'),p.style.left=wi+"px",au(),rf=!0);ut=sj_ce("div","","ev_zo_tooltip");ut.innerText="搜索";_d.body.appendChild(ut);MsnShared.hide(ut)}function vf(n,t){var u=document.createElement("canvas"),i=u.getContext("2d"),r;return i.font=t||"12px",r=i.measureText(n),r.width}function au(){navigator.userAgent.toLowerCase().indexOf("trident")>-1&&(p.style.top="-14px")}function yf(){d.className&&d.className!="ev_tb_headerselect_open"?(d.className="ev_tb_headerselect_open",tt.className="ev_tb_header_dropdown_open",a.className=="ev_tb_disable_setting"&&(a.className="b_hide"),l.className="b_hide",st.className="b_hide"):(d.className="ev_tb_header_select_close",tt.className="ev_tb_header_dropdown_close")}function pf(){sj_be(d,"click",function(){yf()});sj_be(_ge("ev_talkbox_wrapper"),"click",function(n){n.target.className=="ev_tb_disable"?a.className=="b_hide"&&l.className=="b_hide"?(a.className="ev_tb_disable_setting",d.className=="ev_tb_headerselect_open"&&(d.className="ev_tb_header_select_close",tt.className="ev_tb_header_dropdown_close")):l.className=="ev_disable_popup_setting"?(l.className="b_hide",st.className="b_hide"):a.className="b_hide":n.target.className=="ev_tb_disable_setting"?l.className=="b_hide"?(a.className="b_hide",l.className="ev_disable_popup_setting",st.className="ev_disable_popup_background"):(l.className="b_hide",st.className="b_hide"):a.className=="ev_tb_disable_setting"&&(a.className="b_hide")});sj_be(_ge("ev_disable_popup_setting_btn1"),"click",function(){ft("##Disable##","disablechat")});sj_be(_ge("ev_disable_popup_setting_btn2"),"click",function(){l.className="b_hide";st.className="b_hide"});sj_be(b,"click",function(){a.className=="ev_tb_disable_setting"&&(a.className="b_hide")});sj_be(_ge("uaseabox"),"click",function(){yu();hr=!1;di(p,t.OverEyeAnimationUrl);ri=!0;p.style.top="-51px";sb_st(function(){ri&&(di(p,t.OverEyeStaticAnimationUrl),cr=!0,ri=!1)},8e3)});sj_be(_d,"mouseup",function(n){n.target.id!="uaseabox"&&(au(),(ri||cr)&&(ri=!1,cr=!1,di(p,t.LooseHandAnimationUrl)))});sj_be(p,"click",function(){c()&&Log.Log("DHTMLClick",e,"clickSBA",!1)});sj_be(p,"mouseover",function(){c()&&Log.Log("DHTMLClick",e,"focusSBA",!1)});sj_be(nt,"click",function(n){n.target.className!="ev_enlarge_img"&&MsnShared.hide(nt)});sj_be(ur,"click",function(){MsnShared.hide(nt)})}function ki(){var t=fr+91;ht.style.width="348px";var s=348*u.height/u.width,i=348,n=479,f=0,r=0,e=10,o=10;u.width/u.height>.83?t<479?s>t?(i=t*u.width/u.height,n=t,f=(348-i)/2,o=f+10):(n=348*u.height/u.width,r=(t-n)/2,e=r+10):(n=348*u.height/u.width,r=(479-n)/2,e=r+10):(t<479?(n=t,i=t*u.width/u.height):i=479*u.width/u.height,i>348?(i=348,n=348*u.height/u.width,r=(479-n)/2,e=r+10):f=(348-i)/2);ht.style.cssText=";height: "+n+"px; width: "+i+"px; margin-top: "+r+"px; margin-left: "+f+"px";ur.style.cssText=";top: "+e+"px; right: "+o+"px"}function di(n,t){var i=new Image;i.src=t;i.complete?n.src=t:i.onload=function(){n.src=t}}function wf(){sb_st(function(){hr&&di(p,t.StaticAnimationUrl)},8e3)}function bf(){MsnShared.hide(_ge("ev_talkbox_wrapper"))}function kf(){sj_be(it,"click",function(){yr(s)});sj_be(at,"click",function(){yr(lt)});sj_be(vt,"click",function(){yr(ti)})}function yr(n){i=n;it.className="ev_tb_header_dropdown_button_ice";at.className="ev_tb_header_dropdown_button_boy";vt.className="ev_tb_header_dropdown_button_girl";d.className="ev_tb_header_select_close";tt.className="ev_tb_header_dropdown_close";c()&&Log.Log("DHTMLClick",e,"selectBotType",!1,"botType",i);n==s?(it.className=rt,g.innerHTML=yt,y=1,ft("","click"),MsnShared.show(b),MsnShared.hide(w)):(t.iframeTalkStatus&&navigator.cookieEnabled?(h.style.cssText=";background-image: url("+t.VirtualCharacterEntryUrl+")",n==lt?(at.className=rt,g.innerHTML=er,w.src=fu):n==ti&&(vt.className=rt,g.innerHTML=or,w.src=eu),MsnShared.show(w),MsnShared.hide(b)):(MsnShared.show(b),ne(),MsnShared.hide(w),it.className=rt,g.innerHTML=yt,i=s),vr(dt));sj_cook.set(gt,ni,i)}function df(){sj_be(k,"click",function(n){n.target.className!="ev_hook_header_close"&&(MsnShared.show(f),_ge(si).focus(),MsnShared.hide(k),MsnShared.hide(r))})}function gf(){sj_be(_ge("ev_hook_header_close"),"click",function(){pi=!0;sj_cook.get(ru)?sj_cook.setNoCrumbs(ci,"TRUE",!0,"/",10080):sj_cook.setNoCrumbs(ci,"TRUE",!0,"/",20160);MsnShared.removeClass(o,"ev_talkbox_wrapper");MsnShared.addClass(o,"ev_talkbox_wrapper_min");oi();MsnShared.show(r);MsnShared.hide(k);MsnShared.hide(f)})}function pr(){i==s?(h.className="ev_min_cn_img",sj_cook.get(rr)?sj_cook.get(uu)?(ui=!1,oi()):vu(";background-image: url("+t.WeakAttractEntryUrl+"); width: 80px",uu,1440):vu(";background-image: url("+t.StrongAttractEntryUrl+"); width: 100px; margin-right: 1px",rr,10080)):h.className="ev_min_virtual_img"}function vu(n,t,i){ui=!0;pt=!1;h.style.cssText=n;sj_cook.setNoCrumbs(t,"TRUE",!0,"/",i);ei=sb_st(function(){ui=!1;oi()},1e4)}function oi(){sb_ct(ei);sb_ct(fi);sb_ct(wt);pt=!0;kt(t.BlinkEyeEntryUrl);fi=sb_st(function(){pt=!1;kt(t.CloseEyeEntryUrl);wt=sb_st(function(){kt(t.KeepSleepEntryUrl)},5e3)},1e4)}function ne(){var t=et(ku,!0,!1,"","1"),n=_ge(v);n.appendChild(t);n.scrollTop=n.scrollHeight}function bt(n,t){lr();var i=et(n,!0,!1,"",t);sb_st(function(){y=1;bi();var n=_ge(v);n.appendChild(i);n.scrollTop=n.scrollHeight},1500)}function te(){var u=!1,f,n;r.onmousedown=function(n){f=n.clientY-r.offsetTop;_ge("ev_hook").className=="b_hide"&&(u=!0)};_d.onmousemove=function(t){var i,e,o,s;if(u)n=t.clientY-f,o=((i=_d.documentElement)===null||i===void 0?void 0:i.clientHeight)||((e=_d.body)===null||e===void 0?void 0:e.clientHeight),s=o-r.offsetHeight,n=Math.min(s,Math.max(0,n)),r.style.top=n+"px",wi=!0;else return};_d.onmouseup=function(){u=!1;wi&&c()&&Log.Log("DHTMLClick",e,"moveIcon",!1,"currentTop",n+"px")};sj_be(r,"mouseover",function(){i!=s||ui||(sb_ct(ei),sb_ct(fi),sb_ct(wt),kt(t.BlinkEyeEntryUrl))});sj_be(r,"mouseout",function(){i!=s||ui||oi()});sj_be(_ge("sb_form_q"),"click",function(){yu()})}function kt(n){var t=new Image;t.src=n;t.complete?h.style.cssText=";background-image: url("+n+"); width: 75px":t.onload=function(){h.style.cssText=";background-image: url("+n+"); width: 75px"}}function yu(){pt&&(sb_ct(ei),sb_ct(fi),sb_ct(wt),pt=!1,kt(t.CloseEyeEntryUrl),wt=sb_st(function(){kt(t.KeepSleepEntryUrl)},5e3))}function pu(n,u){var kt=!1,h,ft,ot,st,nt,ht,d,ut,p,wt,l,ei;try{h=JSON.parse(n)}catch(oi){return c()&&Log.Log("JsonParseError",e,"getZoChatJsonParse",!1),!1}if(h){kt=!0;ft=h.content;nr=ft;var ri=h.entityInfo,ui=h.target,tt=h.history,a=h.delayContents,fi=h.type;if(ii=vi=yi=sr="",h.metadata&&(h.metadata.AnswerFeed&&(ii=h.metadata.AnswerFeed),h.metadata.EmotionInfo&&(vi=h.metadata.EmotionInfo),h.metadata.CustomLog&&(yi=h.metadata.CustomLog),h.metadata.HyperLinkFormcode&&(sr=h.metadata.HyperLinkFormcode)),nu){if(h.showChatBox&&!t.DisableChatFeature&&cf(),ot=tt&&tt.chatLogs&&tt.chatLogs.length>0,tu&&ot)for(tu=!1,st=0;st<tt.chatLogs.length;st++)nt=tt.chatLogs[st],nt&&nt.content&&nt.entityInfo&&(ot=!0,ht=et(nt.content,nt.isBot,!1,nt.entityInfo,nt.type),d=_ge(v),d.appendChild(ht),d.scrollTop=d.scrollHeight);if(ut=sj_cook.get(hi,tr),ct){var ht=et(ai,!1,!1,"","1"),d=_ge(v),pt=MsnShared.getElementsByClassName("ev_zo_typing","div",d);pt&&pt.length>0?d.insertBefore(ht,pt[0].parentElement):d.appendChild(ht);d.scrollTop=d.scrollHeight;ct=!1;i=s;ut="1";sj_cook.set(hi,tr,"1");sj_cook.set(gt,ni,s)}i==s?(it.className=rt,g.innerHTML=yt):i==lt?(at.className=rt,g.innerHTML=er,w.src=fu):(vt.className=rt,g.innerHTML=or,w.src=eu);p=li;ut!=ir?i==lt||i==ti?(MsnShared.show(w),MsnShared.hide(b),MsnShared.show(f),MsnShared.hide(r),MsnShared.hide(k),MsnShared.removeClass(o,"ev_talkbox_wrapper_min"),MsnShared.addClass(o,"ev_talkbox_wrapper"),p=nf):(wt=sj_cook.get(ci),h.isHookStr&&wt&&(pi=!0),h.isHookStr&&!wt?i!=s||sj_cook.get(rr)?(MsnShared.removeClass(o,"ev_talkbox_wrapper_min"),MsnShared.addClass(o,"ev_talkbox_wrapper"),_ge("ev_hook_header_text_reply").innerText=ft,MsnShared.show(k),MsnShared.hide(f),MsnShared.hide(r),p=gu):(pr(),MsnShared.show(r),MsnShared.hide(f),MsnShared.hide(k),p=li):ut==dt&&ot?(ar(!1),p=ou):ut==dt&&su()?(ar(!1),p=ou):(pr(),MsnShared.show(r),MsnShared.hide(f),MsnShared.hide(k),p=li)):(pr(),MsnShared.show(r),p=i!=s?tf:li);c()&&h.showChatBox&&(window.performance.navigation.type==1?Log.Log("FirstShowType",e,p,!1,"LoadType","Refresh"):Log.Log("FirstShowType",e,p,!1,"LoadType","FirstLoad"))}ui=="a"||ui=="b"?(u=="externallink"||u=="click"?(lr(),sb_st(function(){y=1;cu(ri,fi)},1500)):cu(ri,fi),dr=ft,gr=(new Date).toUTCString(),l=0,a&&(ei=setInterval(function(){if(t.EnableShowAnswerFeed){var n=a[l].metadata&&a[l].metadata.AnswerFeed?a[l].metadata.AnswerFeed:"";bt(a[l].content+"["+n+"]","1")}else a[l].type?bt(a[l].content,a[l].type):bt(a[l].content,"1");l++;l==a.length&&clearInterval(ei)},3e3))):bi();nu=!1}return kt}var o=_ge("ev_talkbox_wrapper"),v="ev_talkbox",wr="ev_send_button",si="ev_send_text",t,br="true",kr="false",dr="",gr="",gi="",nr="",y=0,nu=!0,tu=!0,iu=!0,hi="ZHSEARCHCHATSTATUS",tr="STATUS",dt="1",ir="0",e="ChineseChatBot",wu="/search?q={0}&FORM={1}",ru="ZHLASTACTIVECHAT",ci="HOOKBLOCKINDICATOR",gt="ZHSEARCHCHATCHARACTER",ni="CHARACTER",s="0",rr="ZHCHATSTRONGATTRACT",uu="ZHCHATWEAKATTRACT",lt="1",ti="2",i="0",f=sj_ce("div","ev_talkbox_max","b_hide"),k=sj_ce("div","ev_hook","b_hide"),r=sj_ce("div","ev_talkbox_min",null),tt=sj_ce("div","ev_tb_header_dropdown","ev_tb_header_dropdown_close"),it=sj_ce("button","ev_tb_header_dropdown_button_ice","ev_tb_header_dropdown_button_ice"),at=sj_ce("button","ev_tb_header_dropdown_button_boy","ev_tb_header_dropdown_button_boy"),vt=sj_ce("button","ev_tb_header_dropdown_button_girl","ev_tb_header_dropdown_button_girl"),rt="ev_tb_header_dropdown_button_select",d=sj_ce("span","ev_tb_header_select_img","ev_tb_header_select_close"),g=sj_ce("a","ev_tb_header_default_text","ev_tb_header_default_text"),a=sj_ce("div","ev_tb_disable_setting","b_hide"),l=sj_ce("div","ev_disable_popup_setting","b_hide"),st=sj_ce("div","ev_disable_popup_background","b_hide"),p=sj_ce("img","ev_search_bar_animation",""),nt=sj_ce("div","ev_show_enlarge_img","b_hide"),ht=sj_ce("img","ev_enlarge_img","ev_enlarge_img"),ur=sj_ce("div","ev_enlarge_close","ev_enlarge_close"),bu=sj_ce("div","ev_enlarge_background","ev_enlarge_background"),u=new Image,ut,fr,yt="小冰",er="虚拟男友",or="虚拟女友",w=sj_ce("iframe","ev_iframe_talk","b_hide"),b=sj_ce("div","ev_default_talk",null),h=sj_ce("span","ev_min_zo_img",null),fu="https://ux-plus-bing.xiaoice.com/BingVirtualBF",eu="https://ux-plus-bing.xiaoice.com/BingVirtualGF",ku="在【旧版本浏览器】和【阻止第三方Cookie】的设置下不支持召唤虚拟伴侣, 请尝试切换到新版Edge进行体验或打开允许站点读取cookie的相关设置",du="快来定制你的专属虚拟伴侣吧！ ",gu="HookChatBox",ou="MaxDefaultChatBox",nf="MaxVirtualChatBox",li="MinDefaultChatBox",tf="MinVirtualChatBox",ct=!1,ai,sr="",ii="",vi="",yi="",pi=!1,rf=!1,hr=!1,cr=!1,ri=!1,wi=!1,ui=!1,pt=!1,fi,wt,ei;n.init=uf})(ChineseChatV2||(ChineseChatV2={}))